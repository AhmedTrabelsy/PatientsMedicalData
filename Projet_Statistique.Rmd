---
title: 'Projet Statistique : Analyse des Donn√©es M√©dicales'
author: "Ton Nom"
date: "`r format(Sys.Date(), '%d/%m/%Y')`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    number_sections: true
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# 1. Introduction

## 1.1 Contexte
Ce projet vise √† √©tudier un jeu de donn√©es m√©dicales contenant des informations sur les patients : √¢ge, sexe, poids, tension art√©rielle, cholest√©rol, groupe de traitement, dur√©e de suivi et score de sympt√¥mes.

## 1.2 Probl√©matique
> Les caract√©ristiques cliniques (√¢ge, poids, tension, cholest√©rol) et le traitement influencent-ils significativement l‚Äô√©tat des patients (score de sympt√¥mes) ?

## 1.3 Objectifs
- D√©crire les variables (analyse univari√©e)
- √âtudier les relations entre variables (analyse bivari√©e)
- Construire un mod√®le explicatif (analyse multivari√©e)
- Tester les hypoth√®ses statistiques

# 2. Pr√©paration des donn√©es

## 2.1 Chargement des packages

```{r packages}
# Installer les packages si n√©cessaires :
# install.packages(c("tidyverse", "skimr", "GGally", "psych", "broom"))

library(tidyverse)
library(skimr)
library(GGally)
library(psych)
library(broom)
library(effsize)
```

## 2.2 Importation du jeu de donn√©es

```{r import}
data <- read.csv(file.choose(),
                 sep = ";",
                 header = TRUE,
                 stringsAsFactors = FALSE,
                 na.strings = c("", "NA", "NaN", "NULL", "?"))

# üëÄ Aper√ßu rapide du jeu de donn√©es
head(data)
str(data)
```

## 2.3 Nettoyage des donn√©es

```{r cleaning}
data <- data %>%
  rename(
    ID = ID,
    Age = Age,
    Sexe = Sexe,
    Poids = Poids,
    Tension = Tension,
    Cholesterol = Cholesterol,
    Groupe_Traitement = Groupe_Traitement,
    Suivi_Jours = Suivi_Jours,
    Symptom_Score = Symptom_Score
  ) %>%
  mutate(
    Sexe = as.factor(Sexe),
    Groupe_Traitement = as.factor(Groupe_Traitement)
  )

# Suppression des doublons
data <- distinct(data)

# R√©sum√© rapide
skim(data)
```

## 2.4 Gestion des valeurs manquantes

```{r missing-values}
colSums(is.na(data))
data <- na.omit(data)
nrow(data)
```

# 3. Analyse univari√©e

## 3.1 Variables quantitatives

```{r univariate-num}
quant_vars <- c("Age", "Poids", "Tension", "Cholesterol", "Suivi_Jours", "Symptom_Score")

data %>%
  select(all_of(quant_vars)) %>%
  summary()

# Histogrammes
for (v in quant_vars) {
  print(
    ggplot(data, aes_string(x = v)) +
      geom_histogram(bins = 20, fill = "steelblue", color = "white") +
      geom_density(alpha = 0.4, color = "red") +
      labs(title = paste("Distribution de", v))
  )
}
```

### Test de normalit√© (Shapiro-Wilk)

```{r normality}
for (v in quant_vars) {
  cat("Variable :", v, "\n")
  x <- data[[v]]
  if (length(x) > 5000) x <- sample(x, 5000)
  print(shapiro.test(x))
  cat("\n---------------------------------\n")
}
```

## 3.2 Variables qualitatives

```{r univariate-cat}
table(data$Sexe)
table(data$Groupe_Traitement)

ggplot(data, aes(x = Sexe)) +
  geom_bar(fill = "#3498db") +
  labs(title = "R√©partition par sexe", x = "Sexe", y = "Effectif")

ggplot(data, aes(x = Groupe_Traitement)) +
  geom_bar(fill = "#2ecc71") +
  labs(title = "R√©partition par groupe de traitement", x = "Groupe", y = "Effectif")
```

# 4. Analyse bivari√©e

## 4.1 Corr√©lations entre variables quantitatives

```{r correlation}
cor_matrix <- cor(data[, quant_vars])
cor_matrix

GGally::ggcorr(data[, quant_vars], label = TRUE)
```

### Exemple : Corr√©lation entre √¢ge et score de sympt√¥mes

```{r cor-age}
cor.test(data$Age, data$Symptom_Score)

ggplot(data, aes(x = Age, y = Symptom_Score)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "√Çge vs Score de sympt√¥mes")
```

## 4.2 Comparaison de moyennes (score selon le traitement)

```{r anova}
ggplot(data, aes(x = Groupe_Traitement, y = Symptom_Score, fill = Groupe_Traitement)) +
  geom_boxplot() +
  labs(title = "Score selon le groupe de traitement")

# Test ANOVA
anova_test <- aov(Symptom_Score ~ Groupe_Traitement, data = data)
summary(anova_test)

# Test non param√©trique
kruskal.test(Symptom_Score ~ Groupe_Traitement, data = data)
```

## 4.3 Variables qualitatives (Sexe vs Groupe de traitement)

```{r chi2}
tab <- table(data$Sexe, data$Groupe_Traitement)
tab
chisq.test(tab)
```



### Interpr√©tation simplifi√©e




# 6. Limites et perspectives

- Taille d‚Äô√©chantillon limit√©e
- Variables non observ√©es (r√©gime, ant√©c√©dents‚Ä¶)
- Donn√©es manquantes ou non normalis√©es
- Perspectives : ajout de variables, mod√®les non lin√©aires, tests robustes

# 7. Conclusion

Cette √©tude montre les relations entre les caract√©ristiques des patients et leur √©tat de sant√©.
Les analyses descriptives, corr√©lationnelles et de r√©gression permettent de formuler et v√©rifier des hypoth√®ses statistiques fiables.

## 4.4 Comparaison du Symptom_Score entre Hommes et Femmes

### Visualisation : Boxplot avec points individuels

```{r boxplot-sexe, fig.width=8, fig.height=6}
ggplot(data, aes(x = Sexe, y = Symptom_Score, fill = Sexe)) +
  geom_boxplot(alpha = 0.6, outlier.shape = NA) +  # Bo√Ætes semi-transparentes sans doublons d'outliers
  geom_jitter(width = 0.2, alpha = 0.6, size = 2) +  # Points individuels pour voir la distribution
  scale_fill_manual(values = c("F" = "#e74c3c", "M" = "#3498db")) +
  labs(title = "Comparaison du Score de Sympt√¥mes par Sexe",
       x = "Sexe",
       y = "Score de Sympt√¥mes") +
  theme_minimal(base_size = 14)
```

#V√©rification de la normalit√© dans chaque groupe
```{r}
shapiro_H <- shapiro.test(data$Symptom_Score[data$Sexe == "M"])
shapiro_F <- shapiro.test(data$Symptom_Score[data$Sexe == "F"])

cat("P-value Shapiro-Wilk - Hommes :", round(shapiro_H$p.value, 4), "\n")
cat("P-value Shapiro-Wilk - Femmes :", round(shapiro_F$p.value, 4), "\n")
```
#Test de comparaison et taille d'effet


# Chargement du package pour Cohen's d

```{r}



if(shapiro_H$p.value > 0.05 & shapiro_F$p.value > 0.05) {
  cat("\n--- Test param√©trique : t-test de Welch ---\n")
  test_res <- t.test(Symptom_Score ~ Sexe, data = data, var.equal = FALSE)
  print(test_res)
  
  library(effsize)
  d_res <- cohen.d(Symptom_Score ~ Sexe, data = data)
  cat("\nTaille d'effet :\n")
  print(d_res)
  
} else {
  cat("\n--- Test non param√©trique : Wilcoxon-Mann-Whitney ---\n")
  test_res <- wilcox.test(Symptom_Score ~ Sexe, data = data)
  print(test_res)
  
  # Taille d'effet r (approximation)
  z <- qnorm(test_res$p.value / 2)
  r <- abs(z) / sqrt(nrow(data))
  cat(sprintf("\nTaille d'effet approximative (r) = %.3f\n", r))
  cat("Interpr√©tation de r : |r| < 0.3 ‚Üí petit ; 0.3-0.5 ‚Üí mod√©r√© ; > 0.5 ‚Üí grand\n")
}
```

# ANALYSES AVANC√âES 

# A. Effet de la tranche d'√¢ge sur le Symptom_Score (Kruskal-Wallis car non normal)
```{r}
cat("\n>>> A. Effet de l'√¢ge group√© sur le Symptom_Score (Kruskal-Wallis)\n")
```
```{r}
data$age_groupe <- cut(data$Age, 
                       breaks = c(0, 40, 60, 100), 
                       labels = c("Jeune (<40 ans)", "Moyen (40-60 ans)", "Senior (>60 ans)"))

kruskal_age <- kruskal.test(Symptom_Score ~ age_groupe, data = data)
print(kruskal_age)
```

# B. Effet du niveau de cholest√©rol sur le Symptom_Score (Kruskal-Wallis)
```{r}
cat("\n>>> B. Effet du cholest√©rol group√© sur le Symptom_Score (Kruskal-Wallis)\n")
```
```{r}
data$chol_groupe <- cut(data$Cholesterol, 
                        breaks = c(0, 200, 1000), 
                        labels = c("Normal (‚â§200)", "√âlev√© (>200)"))

kruskal_chol <- kruskal.test(Symptom_Score ~ chol_groupe, data = data)
print(kruskal_chol)
```

# C. Test d'interaction : Le groupe de traitement mod√®re-t-il l'effet de l'√¢ge ?
```{r}
cat("\n>>> C. TEST D'INTERACTION : Groupe_Traitement √ó √Çge sur Symptom_Score\n")
model_inter_age <- lm(Symptom_Score ~ Groupe_Traitement * Age, data = data)
print(summary(model_inter_age)$coefficients)
cat("(Regarder la ligne 'Groupe_TraitementB:Age'. Si p < 0.05, l'interaction existe : l'effet de l'√¢ge diff√®re selon le traitement.)\n")
```
# Bonus : Interaction Sexe √ó Groupe_Traitement
```{r}
cat("\n>>> D. BONUS : Interaction Sexe √ó Groupe_Traitement sur Symptom_Score\n")
```
```{r}
model_inter_sexe <- lm(Symptom_Score ~ Groupe_Traitement * Sexe, data = data)
print(summary(model_inter_sexe)$coefficients)
cat("(Regarder la ligne 'Groupe_TraitementB:SexeM'. Si p < 0.05, l'effet du traitement diff√®re selon le sexe.)\n")
```

# Graphique Final Synth√®se
```{r}
cat("\n>>> Graphique de synth√®se final\n")
```
```{r}
print(
  ggplot(data, aes(x = Age, y = Symptom_Score, color = Groupe_Traitement)) +
    geom_point(size = 3, alpha = 0.8) +
    geom_smooth(method = "lm", se = TRUE, size = 1.2) +
    facet_wrap(~ Sexe) +
    labs(title = "Mod√®le Final : √Çge et Score de Sympt√¥mes",
         subtitle = "Lignes de r√©gression par groupe de traitement, stratifi√© par sexe",
         x = "√Çge (ans)",
         y = "Score de Sympt√¥mes",
         color = "Groupe Traitement") +
    theme_minimal(base_size = 14)
)

cat("\n--- FIN DE L'ANALYSE EXPERTE ---\n")
```
